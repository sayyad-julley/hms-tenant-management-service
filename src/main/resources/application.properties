# === Factor III: Config via Environment Variables ===
# FAIL FAST if these are missing. No "localhost" defaults allowed in Prod.
server.port=${PORT:8080}
# === Factor VIII: Concurrency (Virtual Threads) ===
spring.threads.virtual.enabled=true
spring.application.name={{ values.serviceName }}

# === PostgreSQL Database ===
# Database (Now using Flyway for migrations)
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${POSTGRES_USER}
spring.datasource.password=${POSTGRES_PASSWORD}

# === Multi-Tenancy (Schema-per-Tenant) ===
spring.jpa.properties.hibernate.multiTenancy=SCHEMA
spring.jpa.properties.hibernate.tenant_identifier_resolver=com.hms.lib.common.tenancy.LibTenantIdentifierResolver
spring.jpa.properties.hibernate.multi_tenant_connection_provider=com.hms.servicename.tenancy.MultiTenantConnectionProvider

# Use 'update' for local dev speed, 'validate' for prod (controlled via env in prod)
# Factor XII: Flyway will handle migrations once dev creates V1__init.sql from their entities
spring.jpa.hibernate.ddl-auto=${HIBERNATE_DDL_AUTO:update}

# === ScaleKit Auth (Base) ===
scalekit.env.url=${SCALEKIT_ENVIRONMENT_URL}
scalekit.client.id=${SCALEKIT_CLIENT_ID}
scalekit.client.secret=${SCALEKIT_CLIENT_SECRET}

# 1. Resource Server (Stateless) Config - ALWAYS ON
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${scalekit.env.url}/.well-known/jwks
spring.security.oauth2.resourceserver.jwt.issuer-uri=${scalekit.env.url}

# === CONDITIONAL CONFIGURATIONS ===




# === Kafka Config (ALWAYS ON for Event-Driven Architecture) ===
spring.kafka.bootstrap-servers=${SPRING_KAFKA_BOOTSTRAP_SERVERS}

# === Kafka Producer (Event Publishing) ===
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.properties.spring.json.add.type.headers=false

# === Kafka Durability (Enterprise Standard) ===
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.max.in.flight.requests.per.connection=1
spring.kafka.producer.properties.enable.idempotence=true

# === Kafka Consumer (Pattern-Specific) ===


# === Permit.io (Authorization Platform) ===
permit.api.key=${PERMIT_API_KEY:}
permit.environment=${PERMIT_ENVIRONMENT:Development}
permit.pdp.url=${PERMIT_PDP_URL:http://permit-pdp:7000}
permit.default.role=${PERMIT_DEFAULT_ROLE:member}



# === Factor VI: Processes (Distributed Sessions) ===


# === Factor XI: Logs ===
# Force JSON output for production consistency
logging.config=classpath:logback-spring.xml

# === Factor IX: Observability ===
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.probes.enabled=true

